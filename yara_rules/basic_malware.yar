rule WindowsExecutable {
    meta:
        description = "Detects Windows PE files"
        author = "GhostSec"
        date = "2024-02"
        version = "1.0"
    
    strings:
        $mz = "MZ"
        $pe = "PE"
        $dos_stub = "This program cannot be run in DOS mode"
        
    condition:
        $mz at 0 and $pe and $dos_stub
}

rule PotentialMalware {
    meta:
        description = "Detects potential malware indicators"
        author = "GhostSec"
        date = "2024-02"
        version = "1.0"
        
    strings:
        $sus_api1 = "CreateRemoteThread" ascii wide
        $sus_api2 = "VirtualAllocEx" ascii wide
        $sus_api3 = "WriteProcessMemory" ascii wide
        $sus_api4 = "ReadProcessMemory" ascii wide
        $sus_api5 = "LoadLibraryA" ascii wide
        
        $anti_dbg1 = "IsDebuggerPresent" ascii wide
        $anti_dbg2 = "CheckRemoteDebuggerPresent" ascii wide
        $anti_dbg3 = "OutputDebugString" ascii wide
        
        $network1 = "WSAStartup" ascii wide
        $network2 = "connect" ascii wide
        $network3 = "InternetOpen" ascii wide
        
    condition:
        (2 of ($sus_api*)) or
        (any of ($anti_dbg*)) or
        (2 of ($network*))
}

rule RansomwareIndicators {
    meta:
        description = "Detects common ransomware behaviors"
        author = "GhostSec"
        date = "2024-02"
        version = "1.0"
        
    strings:
        $encrypt_api1 = "CryptoAPI" ascii wide
        $encrypt_api2 = "BCryptEncrypt" ascii wide
        $encrypt_api3 = "CryptEncrypt" ascii wide
        
        $ransom_str1 = "bitcoin" ascii wide nocase
        $ransom_str2 = "ransom" ascii wide nocase
        $ransom_str3 = "encrypted" ascii wide nocase
        $ransom_str4 = "decryption" ascii wide nocase
        
        $file_ext = { 2E [1-4] 00 } // File extensions (.)
        
    condition:
        (any of ($encrypt_api*)) and
        (2 of ($ransom_str*)) and
        #file_ext > 10
}

rule Keylogger {
    meta:
        description = "Detects potential keylogging functionality"
        author = "GhostSec"
        date = "2024-02"
        version = "1.0"
        
    strings:
        $api1 = "SetWindowsHookEx" ascii wide
        $api2 = "GetAsyncKeyState" ascii wide
        $api3 = "GetKeyboardState" ascii wide
        $api4 = "MapVirtualKey" ascii wide
        
        $str1 = "keylog" ascii wide nocase
        $str2 = "keyboard" ascii wide nocase
        $str3 = "hook" ascii wide nocase
        
    condition:
        2 of ($api*) or (any of ($api*) and any of ($str*))
}
